<html>
	<head>
		<style>
			canvas {
				position: fixed;
				top: 0;
				left: 0;
			}
			body {
				margin: 0;
			}
		</style>
		<link rel = 'icon' href="https://drive.google.com/favicon.ico">
		<title>My Drive - Google Drive</title>
		<script>
			window.addEventListener('error', (e) => {
				if (!localStorage.useAlertError) alert(e.stack || e.message + ' at ' + e.filename + ':' + e.lineno + ':' + e.colno);
			});
		</script>
		<style>
		</style>

	</head>
	
	<body>
		<img id = 'explode' style = 'display: block;' src = 'data:image/png;base64,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'>
		
		<script>
			
			try {
				window.addEventListener('keydown', (e) => {
					if (e.key === 'i' && e.ctrlKey) {
						e.preventDefault();
						eval(prompt('>'));
					}
				});
				const canvas = document.createElement('canvas');
				const image = document.getElementById('explode');
				canvas.width = document.body.offsetWidth;
				canvas.height = document.body.offsetHeight;
				document.body.appendChild(canvas);
				const ctx = canvas.getContext('2d');
				ctx.fillStyle = 'black';
				ctx.fillRect(0,0,document.body.offsetWidth, document.body.offsetHeight);
				const scoreEl = document.body.appendChild(document.createElement('div'));
				scoreEl.innerHTML = '0';
				scoreEl.style.cssText = `
					color: white;
					top: 0;
					right: 0;
					position: fixed;
					z-index: 50;
					padding: 10px;
					font-size: 25px;
					font-weight: bold;
					font-family: Arial
				`;

				// high score element
				const hse = document.body.appendChild(document.createElement('div'));
				hse.innerHTML = (localStorage.getItem('high') || '').length === 0 ? '0' : localStorage.getItem('high');
				hse.style.cssText = `
					color: white;
					top: 0;
					left: 0;
					position: fixed;
					z-index: 50;
					padding: 10px;
					font-size: 25px;
					font-weight: bold;
					font-family: Arial;
					cursor: pointer;
				`;

				hse.addEventListener('click', () => window.addEventListener('unload', () => localStorage.setItem('high', '0')));
				
				let gravity = 1; //-Math.random();
				//setInterval(() => {gravity = -Math.random()}, 100);
				let score = 0;
				let high = parseInt(localStorage.getItem('high')) || 0;
	
				function rectCollides (r1, r2) {
					return r1.x < r2.x + r2.width && r2.x < r1.x + r1.width && r1.y < r2.y + r2.height && r2.y < r1.y + r1.height;
				}

				let fingerDown = false;
				
				class Player {
					constructor () {
						this.width = 30 * .25;
						this.height = 30 * .25;
						this.y = document.body.offsetHeight / 2;
						this.velocity = 0;
						this.color = 'orange';
						this.deadColor = 'red';
						this.jumpSpeed = -15 * (gravity > 0 ? 1 : -1);
						this.swing = true;
						
						window.addEventListener('keydown', (e) => {
							if (!e.repeat && (e.key == ' ' || e.key == 'z')) {
								this.jump(e);
							} else if (e.key === 'x') {
								this.swing = !this.swing;
							}
						});
						
						window.addEventListener('mousedown', (e) => {
							if (fingerDown) {
								fingerDown = false;
								return;
							}
							this.jump();
						});
						
						this.trails = [];
					}
					
					/**
					 * @param {Event} e
					*/
					jump (e) {
						if (e) {
							e.preventDefault();
							e.stopPropagation();
						}
						if (!this.swing) this.velocity = this.jumpSpeed;
						else gravity *= -1;
					}
					
					update (notDead, multiplier) {
						try {
							this.velocity += gravity *.25;
							this.y += this.velocity * multiplier;
							if (this.y < 0) {
								this.y = 0;
								this.velocity = 0;
							}
							if (this.y + this.height > document.body.offsetHeight){
								this.y = document.body.offsetHeight - this.height;
								this.velocity = 0;
							}
							ctx.beginPath();
							ctx.lineWidth = 5 * .25;
							this.trails.push({x: document.body.offsetWidth / 2, y: this.y + this.height / 2});
							for (let j = this.trails.length - 1; j >=0; j--) {
								this.trails[j].x -= poleSpeed * multiplier;
								if (this.trails[j].x < -poleSpeed * 2) this.trails.splice(j, 1);
								else {
									ctx.lineTo(this.trails[j].x, this.trails[j].y);
									ctx.strokeStyle = 'rgba(255,255,255,' + (j / (true ? this.trails.length : document.body.offsetWidth / 2 / poleSpeed)).toString() + ')';
									ctx.stroke();
									ctx.beginPath();
									ctx.moveTo(this.trails[j].x, this.trails[j].y);
								}
							}
							ctx.strokeStyle = 'white';
							ctx.moveTo(this.trails[0].x, this.trails[0].y);
							ctx.lineTo(document.body.offsetWidth / 2 , this.y + this.height / 2);
							//ctx.stroke();

							ctx.fillStyle = notDead ? this.color : this.deadColor;
							ctx.fillRect(document.body.offsetWidth / 2 - this.width / 2, this.y, this.width, this.height);
							if (!notDead) {
								ctx.drawImage(image, this.x, this.y, this.width, this.height);
							}
						} catch (e) {
							alert(e);
						}
					}
				}
	
				let poles = [];
				let frames = 1;
				let poleGap = 300 * .25;
				const poleSpace = 100;
				let poleSpeed = 30 * .25;
				const poleWidth = 90 * .25;
				let poleColor = 'white';
				const poleMinMargin = 100 * .25;
	
				class PoleSet {
					constructor () {
						this.width = poleWidth;
						this.gap = poleGap;
						this.color = poleColor;
						this.topGap = Math.random() * (document.body.offsetHeight - this.gap - poleMinMargin * 2) + poleMinMargin;
						this.x = document.body.offsetWidth + 200;
						this.hasScored = false;
					}
	
					update (playerY, playerWidth, playerHeight, multiplier) {
						this.x -= poleSpeed * multiplier;
						ctx.fillStyle = this.color;
						ctx.fillRect(this.x, 0, this.width, this.topGap);
						ctx.fillRect(this.x, this.topGap + this.gap, this.width, document.body.offsetHeight - this.topGap - this.gap);
						if (this.x + this.width < document.body.offsetWidth - playerWidth / 2 && !this.hasScored) {
							this.hasScored = true;
							score += 1;
							if (score > high) {
								poleColor = 'green';
								this.color = 'green';
							}
						}
						
						return rectCollides({x: document.body.offsetWidth / 2 - playerWidth / 2, y: playerY, width: playerWidth, height: playerHeight}, {x: this.x, y: 0, width: this.width, height: this.topGap}) || rectCollides({x: document.body.offsetWidth / 2 - playerWidth / 2, y: playerY, width: playerWidth, height: playerHeight}, {x: this.x, y: this.topGap + this.gap, width: this.width, height: document.body.offsetHeight - this.topGap - this.gap});
					}
				}
				
				const player = new Player();
				let last = performance.now() || Date.now() || new Date().getTime();
				const idealFps = 1000/60;
				function update (time) {
					try {
						poleGap *= .9998;
						poleSpeed *= 1.0004

						const multiplier = true ? 1 : (time - last) / idealFps;
						last = time;
						ctx.fillStyle = 'black';
						ctx.fillRect(0, 0, document.body.offsetWidth, document.body.offsetHeight);
	
						let keepGoing = true;
						frames += multiplier;
						if (frames > poleSpace) {
							frames = 0;
							poles.push(new PoleSet());
						}
						for (let i = poles.length - 1; i > -1; i--) {
							if (poles[i].update(player.y, player.width, player.height, multiplier)) {
								keepGoing = false;
								setTimeout( () => {
									location.reload();return;
									if (confirm('You died. Your score was: ' + score.toString() +  ' reload the page?')) {
										location.reload();
										history.go(0);
									} else {
										location.reload();
									}
								}, 10);
							} else if (poles[i].x + poles[i].width < -200) {
								poles.slice(i);
							}
						}
						player.update(keepGoing, multiplier);
						scoreEl.innerHTML = score.toString();
						if (keepGoing) {
							requestAnimationFrame(update);
						} else {
							localStorage.setItem('high', Math.max(score, high));
						}
						
					} catch (e) {
						alert(e);
					}
				}
				
				requestAnimationFrame(update);
				canvas.addEventListener('touchstart', (e) => {
					e.preventDefault();
					player.jump.bind(player)();
					// gravity = -Math.abs(gravity);
					fingerDown = true;
				});
				// canvas.addEventListener('touchend', (e) => {
				// 	e.preventDefault();
				// 	gravity = Math.abs(gravity);
				// 	fingerDown = false;
				// });

				window.oncontextmenu = function(event) {
					event.preventDefault();
					event.stopPropagation();
					return false;
				};

			} catch (e) {
				alert(e);
			}
		</script>
	</body>
</html>